name: ATELIER 3 - Flask + ngrok (tout-en-un)

on:
  push:
    branches:
      - main  # change this if your default branch is different

jobs:
  flask-ngrok:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Installer Python + pip
        run: sudo apt-get update && sudo apt-get install -y python3-pip

      - name: ðŸ§ª Installer Flask + pyngrok
        run: pip3 install flask pyngrok

      - name: ðŸš€ Lancer Flask avec ngrok (120s)
        run: |
          echo "
from flask import Flask
from pyngrok import ngrok
import threading, time

app = Flask(__name__)

@app.route('/')
def home():
    return 'âœ… Serveur Flask lancÃ© via GitHub Actions + ngrok'

def run_ngrok():
    url = ngrok.connect(5000)
    print(f'ðŸ”— Lien ngrok: {url.public_url}')
    time.sleep(120)
    ngrok.kill()

if __name__ == '__main__':
    threading.Thread(target=run_ngrok).start()
    app.run(host='0.0.0.0', port=5000)
          " > app.py

          python3 app.py
